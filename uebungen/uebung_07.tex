% ##########################################################################
% ############################# Übungsblatt 07 #############################
% ##########################################################################
\section{Übungsblatt}
\label{sec:uebung_07}

% ############################### Aufgabe 01 ###############################
\subsection{Aufgabe}
\label{sec:uebung_07.aufgabe_01}
Erstellen Sie eine Funktion, die anhand eines Parameters den Umsatz eines Lieferanten ausgibt, die der Lieferant durch Verkauf von Materialien erzielt hat.

\begin{example-popup}
  \begin{sqlcode}
    EXEC GET_SUPPLIER_SALES_VOLUME ('81d912b3-a3a5-49ff-9c8d-599fcd12aad9');
  \end{sqlcode}
  \texttt{Stahlhandel Saarlouis E.K. hat einen Umsatz von 54741.54 erziehlt.}
\end{example-popup}

\subsubsection*{Lösung}
\label{sec:uebung_07.aufgabe_01.loesung}
\inputsql{sql/uebung_07/aufgabe_01.plsql}

% ############################### Aufgabe 02 ###############################
\subsection{Aufgabe}
\label{sec:uebung_07.aufgabe_02}
Erstellen Sie eine Funktion, die anhand von Parametern einen neuen Mitarbeiter in der Datenbank anlegt.

\begin{example-popup}
  \begin{sqlcode}
    EXEC INSERT_EMPLOYEE('Hans', 'Wurst', TO_DATE('1984-04-30', 'YYYY-MM-DD'), SYSDATE, 'Hauptstraße 100', '50667');
  \end{sqlcode}
\end{example-popup}

Stellen Sie sicher, dass die übergebenen Parameter valide sind und versuche Sie Fehler abzufangen.

\subsubsection*{Lösung}
\label{sec:uebung_07.aufgabe_02.loesung}
\inputsql{sql/uebung_07/aufgabe_02.plsql}

% ############################### Aufgabe 03 ###############################
\subsection{Aufgabe}
\label{sec:uebung_07.aufgabe_03}
Erstellen Sie eine Funktion, die einen \sqlinline{CURSOR} als Parameter erhält um die Ausgabe der Mitarbeiter auf \texttt{STDOUT} benutzerdefiniert anzupassen.

\begin{example-popup}
  \inputsqlnolinenos{./sql/uebung_07/aufgabe_03_snippet.plsql}
\end{example-popup}

Stellen Sie sicher, dass die übergebenen Parameter valide sind und versuche Sie Fehler mit einem \sqlinline{BEGIN, EXCEPTION, END}-Block abzufangen.

\subsubsection*{Lösung}
\label{sec:uebung_07.aufgabe_03.loesung}
\inputsql{sql/uebung_07/aufgabe_03.plsql}

% ############################### Aufgabe 04 ###############################
\subsection{Aufgabe}
\label{sec:uebung_07.aufgabe_04}
Erstellen Sie eine Prozedur, die die Anzahl an Lieferanten pro Land/Bundesland/Stadt/PLZ für Deutschland ausgibt. Dabei soll zusätzlich die Anzahl an Ansprechpartnern ausgegeben werden und das Datum, an dem das letzte mal Ware von den Umternehmen bezogen wurde.

\subsubsection*{Lösung A}
\label{sec:uebung_07.aufgabe_04.loesung.A}
\inputsql{sql/uebung_07/aufgabe_04a.plsql}

\subsubsection*{Lösung B}
\label{sec:uebung_07.aufgabe_04.loesung.B}
\inputsql{sql/uebung_07/aufgabe_04b.plsql}

% ############################### Aufgabe 05 ###############################
\subsection{Aufgabe}
\label{sec:uebung_07.aufgabe_05}
Ändere die Aufgabe \ref{sec:uebung_07.aufgabe_04} so ab, dass die Auswahl des Bundeslandes durch einen Parameter eingerenzt werden kann. Nutze dazu Reguläre Ausdrücke.

\subsubsection*{Lösung A}
\label{sec:uebung_07.aufgabe_05.loesung.A}
\inputsql{sql/uebung_07/aufgabe_05a.plsql}

\subsubsection*{Lösung B}
\label{sec:uebung_07.aufgabe_05.loesung.B}
\inputsql{sql/uebung_07/aufgabe_05b.plsql}
